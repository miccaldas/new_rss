[
{"title": "Research log: PCB stepper motor", "links": "/", "content": "I saw this sweet video of tiny magnets moving around a PCB:", "images": []},
{"title": "missing", "links": "https://ui.adsabs.harvard.edu/abs/1988PhDT........25P/abstract", "content": "and decided to replicate.", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/ICRA.2012.6225089", "content": "The SRI system consists of two main ideas:", "images": []},
{"title": "missing", "links": "https://patents.google.com/patent/US8593016B2/en", "content": "The first idea is interesting because it means cheap, precision-manufactured PCBs can be easily transformed into cheap, precise tiny motors.", "images": []},
{"title": "missing", "links": "https://www.youtube.com/watch?v=Bxb3-bT8uxk", "content": "The second idea is interesting because it removes \u201cstiction\u201d / mechanical hysteresis from the system; this allows the authors to demonstrate:", "images": []},
{"title": "missing", "links": "https://www.youtube.com/watch?v=0JNQW34P74o", "content": "Seems pretty cool to me.", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/MARSS.2016.7561729", "content": "Here\u2019s all of the prior art I\u2019ve found about these kinds of systems:", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/marss.2016.7561725", "content": "Ron Pelrine seems to have been investigating the broader topic since at least his 1988 PhD ", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/marss.2017.8001930", "content": " and appears to have led the SRI work:", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/marss.2019.8860975", "content": "Peter Misenko (Bobricus) ", "images": []},
{"title": "missing", "links": "https://ieeexplore.ieee.org/document/8616901", "content": "; seeing his Hackaday writeup made the project seem more achievable for me as a hobbyist than the DARPA-funded SRI research papers:", "images": []},
{"title": "missing", "links": "https://www.mouser.com/ProductDetail/Apex-Microtechnology/PA74/?qs=TiOZkKH1s2RHMlrgSWJuHA%3D%3D", "content": "Miniatur Wunderland has been developing the technology for six years in an effort to build a ", "images": []},
{"title": "missing", "links": "https://ieeexplore.ieee.org/document/9001174", "content": ":", "images": []},
{"title": "missing", "links": "https://hackaday.io/project/154496-2d-actuator-move-micro-robot-in-xy-2d-space", "content": " has their head in the same space.", "images": []},
{"title": "missing", "links": "https://www.youtube.com/watch?v=EJZX66JzVDo", "content": " was also inspired by the SRI video and built a simple board; however, they didn\u2019t provide much detail about the current they needed to successfully move their magnets.", "images": []},
{"title": "missing", "links": "https://www.youtube.com/watch?v=A9eIAHiXQ_I", "content": " discusses simulations for various magnet, wire, and wire gap sizes and implements several PCB platforms:", "images": []},
{"title": "missing", "links": "https://youtu.be/xPUEOhMBpUw", "content": "Carl Bugeja\u2019s ", "images": []},
{"title": "missing", "links": "https://youtu.be/xPUEOhMBpUw?t=257", "content": " has a lot of general experiments with (mostly rotary) PCB motors.", "images": []},
{"title": "missing", "links": "https://youtu.be/xPUEOhMBpUw?t=190", "content": "Planar Motors Inc. (founded 2017) has a very impressive industrial material handling system based on electronics-free, permanent magnet levitating platforms:", "images": []},
{"title": "missing", "links": "https://www.teenytrains.com/", "content": "The basic idea is to have two sets of serpentine coils and selectively run current through them to generate a moving magnetic field that drags along the permanent magnet \u201crobot\u201d.\nConsider this diagram from Vl\u010dek\u2019s thesis; the robot consists of four permanent magnets glued to a square:", "images": []},
{"title": "missing", "links": "http://spritesmods.com/?art=magnmicrobots&page=2", "content": "\nWhen current is run through the first coil (blue), the leftmost pair of magnets are aligned with a magnetic field that\u2019s going into the page.\nStopping the current on the first coil and starting it on the second (dotted, green) shifts the magnetic field to the right and the robot follows.\n(Shout out to ", "images": []},
{"title": "missing", "links": "https://otik.uk.zcu.cz/bitstream/11025/32483/1/Diplomova%20prace%20-%20Jiri%20Vlcek.pdf", "content": " for the right-hand-rule diagram, as well as helping me through undergrad.)", "images": []},
{"title": "missing", "links": "https://www.rugged-circuits.com/the-motor-driver-myth", "content": "When designing a PCB track, we can control:", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/marss49294.2020.9307877", "content": "How do these factors relate the movement forces?\nWe can estimate the force as the difference in energy between when the magnet is un-aligned with a coil (directly above a trace, position 1) and aligned (between two traces, position 2):", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1007/s12213-020-00134-3", "content": "Furthermore, since the disk magnet is polarized through its axis, only the vertical component of the magnetic field contributes to the energy.", "images": []},
{"title": "missing", "links": "https://www.youtube.com/c/CarlBugeja/videos", "content": "We can estimate using the equation for the ", "images": []},
{"title": "missing", "links": "https://www.planarmotor.com/videos.html", "content": ", where the field $B$ is proportional to the current $I$ over the radial distance $r$.", "images": []},
{"title": "missing", "links": "https://youtu.be/E5m2fBQsczs?t=356", "content": "For position 1, first and third traces cancel each other out and the second trace contributes no vertical field component, which leaves just (in our approximation, anyway) the contribution of the fourth trace:", "images": []},
{"title": "missing", "links": "https://library.e.abb.com/public/4874952504104ae5984d23a397ce2c80/10-15%20m1051_EN_72dpi.pdf?x-sign=hU/uuPt+7Z0laMSw5h5Eeg0tSl+WFuyKtU2uzcF9eUyvzYmjuqvYykRPwa0ZnMxn", "content": "\\begin{align}\nB &= I \\frac{1}{\\sqrt{t^2 + (2d)^2}} \\newline\nB_\\mbox{vertical} &= I \\frac{2d}{t^2 + (2d)^2}.\n\\end{align}", "images": []},
{"title": "missing", "links": "https://patents.google.com/patent/WO2020243814A1/en", "content": "For the magnet on the same plane as the traces (t = 0), this agrees with the original equation, which suggests I did my geometry correctly: B = I / 2d.", "images": []},
{"title": "missing", "links": "http://hyperphysics.phy-astr.gsu.edu/hbase/magnetic/magcur.html#c3", "content": "For position 2, the first two wires give us vertical fields", "images": []},
{"title": "missing", "links": "http://hyperphysics.phy-astr.gsu.edu/hbase/magnetic/magcur.html#c3", "content": "\\begin{align}\nB_{\\mbox{vertical} 12} &= I \\left( \\frac{-3d/2}{t^2 + (3d/2)^2} + \\frac{d/2}{t^2 + (d/2)^2} \\right)\n\\end{align}", "images": []},
{"title": "missing", "links": "mailto:kevin@keminglabs.com", "content": "and by symmetry the third and fourth traces will contribute the same vertical field as the first two, giving:", "images": []},
{"title": "missing", "links": "https://amzn.to/30UmFHC", "content": "\\begin{align}\nB_\\mbox{vertical} &= I \\left( \\frac{-3d}{t^2 + (3d/2)^2} + \\frac{d}{t^2 + (d/2)^2} \\right)\n\\end{align}", "images": []},
{"title": "missing", "links": "https://amzn.to/30PLDrs", "content": "At t = 0 this reduces to:", "images": []},
{"title": "missing", "links": "https://amzn.to/3yQkL7t", "content": "\\begin{align}\n &= I \\left( \\frac{-4}{3d} + \\frac{4}{d} \\right) \\newline\n &= I \\frac{8}{3d} \\newline\n &= I \\left( \\frac{2}{d/2} - \\frac{2}{3d/2} \\right)\n\\end{align}", "images": []},
{"title": "missing", "links": "https://amzn.to/3qhPuq0", "content": "which again agrees with the original equation.\n(I\u2019m terrible at algebra, so I gotta keep re-checking\u2026)", "images": []},
{"title": "missing", "links": "https://www.ebay.com/itm/293630703557?ssPageName=STRK%3AMEBIDX%3AIT&var=592502727663&_trksid=p2060353.m2749.l2649", "content": "So in our 4-trace approximation, the energy difference \u2014 and hence the force \u2014 between the unaligned and aligned field positions is:", "images": []},
{"title": "missing", "links": "https://amzn.to/3efduo8", "content": "\\begin{align}\n \\Delta U &= I \\left( \\frac{2d}{t^2 + (2d)^2} - \\frac{-3d}{t^2 + (3d/2)^2} - \\frac{d}{t^2 + (d/2)^2} \\right)\n\\end{align}", "images": []},
{"title": "missing", "links": "https://amzn.to/3efLdhp", "content": "I don\u2019t have an intuition about this gross formula, but if we calculate some values around the dimensions of a 1 mm thick 4-layer PCB:", "images": []},
{"title": "missing", "links": "https://www.eevblog.com/forum/projects/adjustable-500ma-bipolar-current-control-for-pcb-trace-electromagnet/", "content": "we get transition energies:", "images": []},
{"title": "missing", "links": "http://www.spectrum-soft.com/index.shtm", "content": "I was surprised to see that the transition energies become positive (i.e., the universe finds distasteful) at 0.6 and 1.2 mm for the 1 and 2 mm coil widths, respectively, suggesting that beyond those thicknesses we won\u2019t be able to move magnets using coils on the reverse side of the PCB.", "images": []},
{"title": "missing", "links": "https://github.com/MitjaNemec/Kicad_action_plugins/tree/414de1eac161bef5400b215d5089f239ad692be2#replicate-layout", "content": "Take all these predictions with a grain of salt, and definitely ", "images": []},
{"title": "missing", "links": "https://jlcpcb.com/", "content": " if you have an idea of how to model this with more fidelity than my high-school-algebra, 4-wire approximation =D", "images": []},
{"title": "missing", "links": "https://www.mouser.com/new/panasonic/panasonic-pgs-thermal-graphite-sheets/", "content": "Before designing a custom PCB I wanted to quickly establish viability, so I 3D-printed a template and hand-wound two serpentine coils (3 mm coil width / 1.5 mm trace-to-trace) of ", "images": []},
{"title": "missing", "links": "https://patents.google.com/patent/US6445093B1/en", "content": ", covered with ", "images": []},
{"title": "missing", "links": "https://www.pcbway.com/pcb_prototype/Stack_up_for_FPC.html", "content": " (for a smoother surface and to keep the wires from popping out), and drove with a ", "images": []},
{"title": "missing", "links": "https://tinyletter.com/kevinlynagh", "content": " stepper driver I had laying around at a 1.6 A current limit:", "images": []},
{"title": "missing", "links": "/", "content": "Here I\u2019m using a ", "images": []},
{"title": "missing", "links": "missing", "content": " and triggering the steps manually.\nLater I got some ", "images": []},
{"title": "missing", "links": "missing", "content": " where the seller at least listed them as N52, wound another template with 2 mm wide coils, and drove that programmatically:", "images": []},
{"title": "missing", "links": "missing", "content": "I wasn\u2019t able to drive these coils with ", "images": []},
{"title": "missing", "links": "missing", "content": " stepper drivers, even with the current-limiting potentiometer cranked entirely open.\nI suspect that the low resistance and inductance of the coil meant that it appeared as a short and triggered fault shutdown logic.\n(Though I wasn\u2019t able to find anything in the datasheet about minimum motor coil inductance; once I got it working with the TMC driver I stopped looking.)", "images": []},
{"title": "missing", "links": "missing", "content": "After the successful proof of concept, I set about designing a PCB.\nThe requirements were:", "images": []},
{"title": "missing", "links": "missing", "content": "The rough idea was to modulate the current flow via PWM input to an H-bridge driver running the coil.\nShout out to the folks on the ", "images": []},
{"title": "missing", "links": "missing", "content": " who helped me resolve some of the issues with my initial approach.\nIn particular, that the coils needed more inductance to slow current changes such that the average current could be modulated by a ~250 kHz signal, the max switching speed of the H-bridge.", "images": []},
{"title": "missing", "links": "missing", "content": "(Think of a flipping a light switch: If the lights come on instantly, the room will always be fully bright or completely dark; but if the lights dim up/down at a rate much slower than you can flip the switch, you can adjust the room brightness to any level by flipping the switch back and forth.)", "images": []},
{"title": "missing", "links": "missing", "content": "I wasn\u2019t sure how to choose the actual values of the inductor and capacitors, so I modeled the circuit in ", "images": []},
{"title": "missing", "links": "missing", "content": ", a long-time commercial simulation software recently released as free. (Thanks, hope you are enjoying your retirement!)", "images": []},
{"title": "missing", "links": "missing", "content": "This diagram shows the current for pulse widths from 0.5 us to 4 us for a 250 kHz PWM signal; note that 4 us is the period of a 250 kHz signal, so the topmost current corresponds to a fully open switch and settles at the maximum steady state current of 5 V / 8 \u03a9 = 625 mA.", "images": []},
{"title": "missing", "links": "missing", "content": "There\u2019s one H-bridge per coil, two coils per dimension, and two zones, so a total of 8 drivers.\n(Shout out to Mitja Nemec for their sweet ", "images": []},
{"title": "missing", "links": "missing", "content": " KiCAD plugin!)", "images": []},
{"title": "missing", "links": "missing", "content": "For the coil patterns themselves I used KiCAD pcbnew\u2019s Python API to generate plain traces and connected them manually to the respective drivers.\nThis felt like a hack \u2014 the coils weren\u2019t assigned to nets and would get eliminated by the \u201ccleanup tracks and vias\u201d tool \u2014 but I\u2019m not sure what the \u201cproper\u201d solution is here; perhaps generating each zone (one side? both sides?) as a footprint and drawing the traces in there?\nI\u2019m open to suggestions if anyone has ideas!", "images": []},
{"title": "missing", "links": "missing", "content": "Anyway, I\u2019m trying to avoid my tendency to get too precious with software, so I had a few drinks and just copy-pasted a lot of garbage Python loops, cleaned up manually, and put in my ", "images": []},
{"title": "missing", "links": "missing", "content": " order on Dec 9 at 23:39.\nFive fully assembled, 0.8 mm thick, 2-layer PCBs were delivered to me in Seattle less than a week later, Dec 15 at 16:02; incredible.", "images": []},
{"title": "missing", "links": "missing", "content": "I got the PCB working:", "images": []},
{"title": "missing", "links": "missing", "content": "which I always find to be a pleasant surprise =D", "images": []},
{"title": "missing", "links": "missing", "content": "The 1 mm coils measure to about 8\u20139 \u03a9, which is pretty close to the 7 \u03a9 estimate from KiCAD\u2019s calculator for a 2.8 m, 0.2 mm wide 1 oz copper trace.\n(Take that number with a grain of salt; my \\$20 multimeter reports 0.3 \u03a9 when its leads are shorted and 3.4 \u03a9 for the three 1 \u03a9 \u00b1 1% series sense resistors.)\nThis gives us a max theoretical current of about 5 V / 12 \u03a9 = 416 mA.", "images": []},
{"title": "missing", "links": "missing", "content": "The 2 mm coils measure to 3.5 \u03a9 so max current will be closer to 700 mA (or whatever Apple\u2019s USB port decides to supply beyond the spec\u2019s 500 mA).", "images": []},
{"title": "missing", "links": "missing", "content": "However, switching frequencies anywhere close 250 kHz gave much lower currents than predicted.\nA 99% duty cycle gave for the 1 mm coil:", "images": []},
{"title": "missing", "links": "missing", "content": "(Currents measured over sense resistors via the stm32f4\u2019s ADC, readings taken 100x and averaged since the current is expected to be pretty choppy.)", "images": []},
{"title": "missing", "links": "missing", "content": "I\u2019m not sure how to explain this:", "images": []},
{"title": "missing", "links": "missing", "content": "It\u2019s hard to say without looking at some waveforms, but my scope is still in Taiwan =(", "images": []},
{"title": "missing", "links": "missing", "content": "For the \u201crobots\u201d I tested both single 1 mm diameter, 1 mm thickness N52 disk magnets and arrays of five such magnets press-fit into a resin-printed carrier, with the center magnet\u2019s polarity opposite the outside four.\nThis array could be reliably actuated at lower currents than the single magnet; the minimum was about 170 mA compared to 200 mA for the single free 1 mm disk magnet.", "images": []},
{"title": "missing", "links": "missing", "content": "As for actuating via back-side coils, theory did in fact correspond to practice!\nI couldn\u2019t get either single magnets nor the array to move on the 1 mm coil, but I was able to move a single magnet on the 2 mm coil.", "images": []},
{"title": "missing", "links": "missing", "content": "For the 1 mm coil I even attached a higher voltage motor driver (drv8833, 10.5 V max motor voltage) and external power supply to push 1.1 A through the coils.\nI also ruled out the possibility the back-side coils were broken by flipping the board over; they work fine when they\u2019re on the surface.", "images": []},
{"title": "missing", "links": "missing", "content": "(Full disclosure: I designed the PCB and burned up a motor driver pushing current through the back-side coils before ever sitting down to do this writeup and the theoretical calculations above, so my algebra could be biased.)", "images": []},
{"title": "missing", "links": "missing", "content": "The back-side 2 mm coils required full current to move the magnet reliably; about 600 mA compared to the 150 mA required by the top-side coils.", "images": []},
{"title": "missing", "links": "missing", "content": "With the basic hardware established, I see three directions for future work:", "images": []},
{"title": "missing", "links": "missing", "content": "Levitation / sliding enhancements: I bought pyrolytic graphite from two sources, but neither clearly levitates my magnets.\nI\u2019m not sure if my samples are substantially different than what SRI used; I have crystalline blocks and they they appear to use flexible sheet \u2014 perhaps ", "images": []},
{"title": "missing", "links": "missing", "content": "?\nBoth SRI and Miniatur Wunderland use Halbach arrays of thin square magnets rather than the disk magnets I\u2019m using; perhaps that extra 4/\u03c0 worth of magnet or the lack of free space between magnets makes all the difference to levitation?", "images": []},
{"title": "missing", "links": "missing", "content": "I could also try improving sliding performance by treating the PCB surface with dry lubricant or drilling open vias / through holes and adding pressurized air to make a sort of air-hockey table (though I have no idea if the millimeter length scale skews more or less stable than the centimeter scale of an air-hockey puck).", "images": []},
{"title": "missing", "links": "missing", "content": "I\u2019d also need to figure out a protocol for measuring sliding friction \u2014 many repetitions of gently tilting a surface and measuring the angle when things slide off?", "images": []},
{"title": "missing", "links": "missing", "content": "Control software: G-code interpreter, closed-loop computer-vision feedback system, zone synchronization (i.e., for a robot to traverse two v1 PCBs side-by-side, the coil phases must match up).\nThere\u2019s a lot to explore in particular if I get levitation working, as this ", "images": []},
{"title": "missing", "links": "missing", "content": " notes:", "images": []},
{"title": "missing", "links": "missing", "content": "As will be appreciated by those skilled in the art, many other commutations may be applied to the coils to achieve force and motion in the x, y, and z directions and torque and rotation about the x, y, and z axes. ", "images": []},
{"title": "missing", "links": "missing", "content": "Applications: Try and do something with the platform \u2014 sort grains of sand, self-moving tiny chess set, flight or ship tracker table top model, cheap precision x/y stage for super-resolution microscopy, some kind of clock/watch aesthetic complications, etc.\nIn addition to refining the platform positioning and velocity accuracy, some applications may also entail designing and manufacturing end-effectors like cute lil\u2019 robot arms or tiny cow catchers.", "images": []},
{"title": "missing", "links": "missing", "content": "All of these directions will inform the next PCB design, which I expect will need to be 4-layers so the two coil layers are closer to the surface.\nIt may also make sense in some cases to use more expensive 0.1 mm thick 2-layer ", "images": []},
{"title": "missing", "links": "missing", "content": ".", "images": []},
{"title": "missing", "links": "missing", "content": "If you liked this, you might like ", "images": []},
{"title": "missing", "links": "missing", "content": ".", "images": []},
{"title": "missing", "links": "missing", "content": "As an Amazon Associate, we may earn commissions from qualifying purchases from Amazon.com.", "images": []}
][
{"title": "Research log: PCB stepper motor", "links": "/", "content": "I saw this sweet video of tiny magnets moving around a PCB:", "images": []},
{"title": "missing", "links": "https://ui.adsabs.harvard.edu/abs/1988PhDT........25P/abstract", "content": "and decided to replicate.", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/ICRA.2012.6225089", "content": "The SRI system consists of two main ideas:", "images": []},
{"title": "missing", "links": "https://patents.google.com/patent/US8593016B2/en", "content": "The first idea is interesting because it means cheap, precision-manufactured PCBs can be easily transformed into cheap, precise tiny motors.", "images": []},
{"title": "missing", "links": "https://www.youtube.com/watch?v=Bxb3-bT8uxk", "content": "The second idea is interesting because it removes \u201cstiction\u201d / mechanical hysteresis from the system; this allows the authors to demonstrate:", "images": []},
{"title": "missing", "links": "https://www.youtube.com/watch?v=0JNQW34P74o", "content": "Seems pretty cool to me.", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/MARSS.2016.7561729", "content": "Here\u2019s all of the prior art I\u2019ve found about these kinds of systems:", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/marss.2016.7561725", "content": "Ron Pelrine seems to have been investigating the broader topic since at least his 1988 PhD ", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/marss.2017.8001930", "content": " and appears to have led the SRI work:", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/marss.2019.8860975", "content": "Peter Misenko (Bobricus) ", "images": []},
{"title": "missing", "links": "https://ieeexplore.ieee.org/document/8616901", "content": "; seeing his Hackaday writeup made the project seem more achievable for me as a hobbyist than the DARPA-funded SRI research papers:", "images": []},
{"title": "missing", "links": "https://www.mouser.com/ProductDetail/Apex-Microtechnology/PA74/?qs=TiOZkKH1s2RHMlrgSWJuHA%3D%3D", "content": "Miniatur Wunderland has been developing the technology for six years in an effort to build a ", "images": []},
{"title": "missing", "links": "https://ieeexplore.ieee.org/document/9001174", "content": ":", "images": []},
{"title": "missing", "links": "https://hackaday.io/project/154496-2d-actuator-move-micro-robot-in-xy-2d-space", "content": " has their head in the same space.", "images": []},
{"title": "missing", "links": "https://www.youtube.com/watch?v=EJZX66JzVDo", "content": " was also inspired by the SRI video and built a simple board; however, they didn\u2019t provide much detail about the current they needed to successfully move their magnets.", "images": []},
{"title": "missing", "links": "https://www.youtube.com/watch?v=A9eIAHiXQ_I", "content": " discusses simulations for various magnet, wire, and wire gap sizes and implements several PCB platforms:", "images": []},
{"title": "missing", "links": "https://youtu.be/xPUEOhMBpUw", "content": "Carl Bugeja\u2019s ", "images": []},
{"title": "missing", "links": "https://youtu.be/xPUEOhMBpUw?t=257", "content": " has a lot of general experiments with (mostly rotary) PCB motors.", "images": []},
{"title": "missing", "links": "https://youtu.be/xPUEOhMBpUw?t=190", "content": "Planar Motors Inc. (founded 2017) has a very impressive industrial material handling system based on electronics-free, permanent magnet levitating platforms:", "images": []},
{"title": "missing", "links": "https://www.teenytrains.com/", "content": "The basic idea is to have two sets of serpentine coils and selectively run current through them to generate a moving magnetic field that drags along the permanent magnet \u201crobot\u201d.\nConsider this diagram from Vl\u010dek\u2019s thesis; the robot consists of four permanent magnets glued to a square:", "images": []},
{"title": "missing", "links": "http://spritesmods.com/?art=magnmicrobots&page=2", "content": "\nWhen current is run through the first coil (blue), the leftmost pair of magnets are aligned with a magnetic field that\u2019s going into the page.\nStopping the current on the first coil and starting it on the second (dotted, green) shifts the magnetic field to the right and the robot follows.\n(Shout out to ", "images": []},
{"title": "missing", "links": "https://otik.uk.zcu.cz/bitstream/11025/32483/1/Diplomova%20prace%20-%20Jiri%20Vlcek.pdf", "content": " for the right-hand-rule diagram, as well as helping me through undergrad.)", "images": []},
{"title": "missing", "links": "https://www.rugged-circuits.com/the-motor-driver-myth", "content": "When designing a PCB track, we can control:", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1109/marss49294.2020.9307877", "content": "How do these factors relate the movement forces?\nWe can estimate the force as the difference in energy between when the magnet is un-aligned with a coil (directly above a trace, position 1) and aligned (between two traces, position 2):", "images": []},
{"title": "missing", "links": "https://sci-hubtw.hkvisa.net/10.1007/s12213-020-00134-3", "content": "Furthermore, since the disk magnet is polarized through its axis, only the vertical component of the magnetic field contributes to the energy.", "images": []},
{"title": "missing", "links": "https://www.youtube.com/c/CarlBugeja/videos", "content": "We can estimate using the equation for the ", "images": []},
{"title": "missing", "links": "https://www.planarmotor.com/videos.html", "content": ", where the field $B$ is proportional to the current $I$ over the radial distance $r$.", "images": []},
{"title": "missing", "links": "https://youtu.be/E5m2fBQsczs?t=356", "content": "For position 1, first and third traces cancel each other out and the second trace contributes no vertical field component, which leaves just (in our approximation, anyway) the contribution of the fourth trace:", "images": []},
{"title": "missing", "links": "https://library.e.abb.com/public/4874952504104ae5984d23a397ce2c80/10-15%20m1051_EN_72dpi.pdf?x-sign=hU/uuPt+7Z0laMSw5h5Eeg0tSl+WFuyKtU2uzcF9eUyvzYmjuqvYykRPwa0ZnMxn", "content": "\\begin{align}\nB &= I \\frac{1}{\\sqrt{t^2 + (2d)^2}} \\newline\nB_\\mbox{vertical} &= I \\frac{2d}{t^2 + (2d)^2}.\n\\end{align}", "images": []},
{"title": "missing", "links": "https://patents.google.com/patent/WO2020243814A1/en", "content": "For the magnet on the same plane as the traces (t = 0), this agrees with the original equation, which suggests I did my geometry correctly: B = I / 2d.", "images": []},
{"title": "missing", "links": "http://hyperphysics.phy-astr.gsu.edu/hbase/magnetic/magcur.html#c3", "content": "For position 2, the first two wires give us vertical fields", "images": []},
{"title": "missing", "links": "http://hyperphysics.phy-astr.gsu.edu/hbase/magnetic/magcur.html#c3", "content": "\\begin{align}\nB_{\\mbox{vertical} 12} &= I \\left( \\frac{-3d/2}{t^2 + (3d/2)^2} + \\frac{d/2}{t^2 + (d/2)^2} \\right)\n\\end{align}", "images": []},
{"title": "missing", "links": "mailto:kevin@keminglabs.com", "content": "and by symmetry the third and fourth traces will contribute the same vertical field as the first two, giving:", "images": []},
{"title": "missing", "links": "https://amzn.to/30UmFHC", "content": "\\begin{align}\nB_\\mbox{vertical} &= I \\left( \\frac{-3d}{t^2 + (3d/2)^2} + \\frac{d}{t^2 + (d/2)^2} \\right)\n\\end{align}", "images": []},
{"title": "missing", "links": "https://amzn.to/30PLDrs", "content": "At t = 0 this reduces to:", "images": []},
{"title": "missing", "links": "https://amzn.to/3yQkL7t", "content": "\\begin{align}\n &= I \\left( \\frac{-4}{3d} + \\frac{4}{d} \\right) \\newline\n &= I \\frac{8}{3d} \\newline\n &= I \\left( \\frac{2}{d/2} - \\frac{2}{3d/2} \\right)\n\\end{align}", "images": []},
{"title": "missing", "links": "https://amzn.to/3qhPuq0", "content": "which again agrees with the original equation.\n(I\u2019m terrible at algebra, so I gotta keep re-checking\u2026)", "images": []},
{"title": "missing", "links": "https://www.ebay.com/itm/293630703557?ssPageName=STRK%3AMEBIDX%3AIT&var=592502727663&_trksid=p2060353.m2749.l2649", "content": "So in our 4-trace approximation, the energy difference \u2014 and hence the force \u2014 between the unaligned and aligned field positions is:", "images": []},
{"title": "missing", "links": "https://amzn.to/3efduo8", "content": "\\begin{align}\n \\Delta U &= I \\left( \\frac{2d}{t^2 + (2d)^2} - \\frac{-3d}{t^2 + (3d/2)^2} - \\frac{d}{t^2 + (d/2)^2} \\right)\n\\end{align}", "images": []},
{"title": "missing", "links": "https://amzn.to/3efLdhp", "content": "I don\u2019t have an intuition about this gross formula, but if we calculate some values around the dimensions of a 1 mm thick 4-layer PCB:", "images": []},
{"title": "missing", "links": "https://www.eevblog.com/forum/projects/adjustable-500ma-bipolar-current-control-for-pcb-trace-electromagnet/", "content": "we get transition energies:", "images": []},
{"title": "missing", "links": "http://www.spectrum-soft.com/index.shtm", "content": "I was surprised to see that the transition energies become positive (i.e., the universe finds distasteful) at 0.6 and 1.2 mm for the 1 and 2 mm coil widths, respectively, suggesting that beyond those thicknesses we won\u2019t be able to move magnets using coils on the reverse side of the PCB.", "images": []},
{"title": "missing", "links": "https://github.com/MitjaNemec/Kicad_action_plugins/tree/414de1eac161bef5400b215d5089f239ad692be2#replicate-layout", "content": "Take all these predictions with a grain of salt, and definitely ", "images": []},
{"title": "missing", "links": "https://jlcpcb.com/", "content": " if you have an idea of how to model this with more fidelity than my high-school-algebra, 4-wire approximation =D", "images": []},
{"title": "missing", "links": "https://www.mouser.com/new/panasonic/panasonic-pgs-thermal-graphite-sheets/", "content": "Before designing a custom PCB I wanted to quickly establish viability, so I 3D-printed a template and hand-wound two serpentine coils (3 mm coil width / 1.5 mm trace-to-trace) of ", "images": []},
{"title": "missing", "links": "https://patents.google.com/patent/US6445093B1/en", "content": ", covered with ", "images": []},
{"title": "missing", "links": "https://www.pcbway.com/pcb_prototype/Stack_up_for_FPC.html", "content": " (for a smoother surface and to keep the wires from popping out), and drove with a ", "images": []},
{"title": "missing", "links": "https://tinyletter.com/kevinlynagh", "content": " stepper driver I had laying around at a 1.6 A current limit:", "images": []},
{"title": "missing", "links": "/", "content": "Here I\u2019m using a ", "images": []},
{"title": "missing", "links": "missing", "content": " and triggering the steps manually.\nLater I got some ", "images": []},
{"title": "missing", "links": "missing", "content": " where the seller at least listed them as N52, wound another template with 2 mm wide coils, and drove that programmatically:", "images": []},
{"title": "missing", "links": "missing", "content": "I wasn\u2019t able to drive these coils with ", "images": []},
{"title": "missing", "links": "missing", "content": " stepper drivers, even with the current-limiting potentiometer cranked entirely open.\nI suspect that the low resistance and inductance of the coil meant that it appeared as a short and triggered fault shutdown logic.\n(Though I wasn\u2019t able to find anything in the datasheet about minimum motor coil inductance; once I got it working with the TMC driver I stopped looking.)", "images": []},
{"title": "missing", "links": "missing", "content": "After the successful proof of concept, I set about designing a PCB.\nThe requirements were:", "images": []},
{"title": "missing", "links": "missing", "content": "The rough idea was to modulate the current flow via PWM input to an H-bridge driver running the coil.\nShout out to the folks on the ", "images": []},
{"title": "missing", "links": "missing", "content": " who helped me resolve some of the issues with my initial approach.\nIn particular, that the coils needed more inductance to slow current changes such that the average current could be modulated by a ~250 kHz signal, the max switching speed of the H-bridge.", "images": []},
{"title": "missing", "links": "missing", "content": "(Think of a flipping a light switch: If the lights come on instantly, the room will always be fully bright or completely dark; but if the lights dim up/down at a rate much slower than you can flip the switch, you can adjust the room brightness to any level by flipping the switch back and forth.)", "images": []},
{"title": "missing", "links": "missing", "content": "I wasn\u2019t sure how to choose the actual values of the inductor and capacitors, so I modeled the circuit in ", "images": []},
{"title": "missing", "links": "missing", "content": ", a long-time commercial simulation software recently released as free. (Thanks, hope you are enjoying your retirement!)", "images": []},
{"title": "missing", "links": "missing", "content": "This diagram shows the current for pulse widths from 0.5 us to 4 us for a 250 kHz PWM signal; note that 4 us is the period of a 250 kHz signal, so the topmost current corresponds to a fully open switch and settles at the maximum steady state current of 5 V / 8 \u03a9 = 625 mA.", "images": []},
{"title": "missing", "links": "missing", "content": "There\u2019s one H-bridge per coil, two coils per dimension, and two zones, so a total of 8 drivers.\n(Shout out to Mitja Nemec for their sweet ", "images": []},
{"title": "missing", "links": "missing", "content": " KiCAD plugin!)", "images": []},
{"title": "missing", "links": "missing", "content": "For the coil patterns themselves I used KiCAD pcbnew\u2019s Python API to generate plain traces and connected them manually to the respective drivers.\nThis felt like a hack \u2014 the coils weren\u2019t assigned to nets and would get eliminated by the \u201ccleanup tracks and vias\u201d tool \u2014 but I\u2019m not sure what the \u201cproper\u201d solution is here; perhaps generating each zone (one side? both sides?) as a footprint and drawing the traces in there?\nI\u2019m open to suggestions if anyone has ideas!", "images": []},
{"title": "missing", "links": "missing", "content": "Anyway, I\u2019m trying to avoid my tendency to get too precious with software, so I had a few drinks and just copy-pasted a lot of garbage Python loops, cleaned up manually, and put in my ", "images": []},
{"title": "missing", "links": "missing", "content": " order on Dec 9 at 23:39.\nFive fully assembled, 0.8 mm thick, 2-layer PCBs were delivered to me in Seattle less than a week later, Dec 15 at 16:02; incredible.", "images": []},
{"title": "missing", "links": "missing", "content": "I got the PCB working:", "images": []},
{"title": "missing", "links": "missing", "content": "which I always find to be a pleasant surprise =D", "images": []},
{"title": "missing", "links": "missing", "content": "The 1 mm coils measure to about 8\u20139 \u03a9, which is pretty close to the 7 \u03a9 estimate from KiCAD\u2019s calculator for a 2.8 m, 0.2 mm wide 1 oz copper trace.\n(Take that number with a grain of salt; my \\$20 multimeter reports 0.3 \u03a9 when its leads are shorted and 3.4 \u03a9 for the three 1 \u03a9 \u00b1 1% series sense resistors.)\nThis gives us a max theoretical current of about 5 V / 12 \u03a9 = 416 mA.", "images": []},
{"title": "missing", "links": "missing", "content": "The 2 mm coils measure to 3.5 \u03a9 so max current will be closer to 700 mA (or whatever Apple\u2019s USB port decides to supply beyond the spec\u2019s 500 mA).", "images": []},
{"title": "missing", "links": "missing", "content": "However, switching frequencies anywhere close 250 kHz gave much lower currents than predicted.\nA 99% duty cycle gave for the 1 mm coil:", "images": []},
{"title": "missing", "links": "missing", "content": "(Currents measured over sense resistors via the stm32f4\u2019s ADC, readings taken 100x and averaged since the current is expected to be pretty choppy.)", "images": []},
{"title": "missing", "links": "missing", "content": "I\u2019m not sure how to explain this:", "images": []},
{"title": "missing", "links": "missing", "content": "It\u2019s hard to say without looking at some waveforms, but my scope is still in Taiwan =(", "images": []},
{"title": "missing", "links": "missing", "content": "For the \u201crobots\u201d I tested both single 1 mm diameter, 1 mm thickness N52 disk magnets and arrays of five such magnets press-fit into a resin-printed carrier, with the center magnet\u2019s polarity opposite the outside four.\nThis array could be reliably actuated at lower currents than the single magnet; the minimum was about 170 mA compared to 200 mA for the single free 1 mm disk magnet.", "images": []},
{"title": "missing", "links": "missing", "content": "As for actuating via back-side coils, theory did in fact correspond to practice!\nI couldn\u2019t get either single magnets nor the array to move on the 1 mm coil, but I was able to move a single magnet on the 2 mm coil.", "images": []},
{"title": "missing", "links": "missing", "content": "For the 1 mm coil I even attached a higher voltage motor driver (drv8833, 10.5 V max motor voltage) and external power supply to push 1.1 A through the coils.\nI also ruled out the possibility the back-side coils were broken by flipping the board over; they work fine when they\u2019re on the surface.", "images": []},
{"title": "missing", "links": "missing", "content": "(Full disclosure: I designed the PCB and burned up a motor driver pushing current through the back-side coils before ever sitting down to do this writeup and the theoretical calculations above, so my algebra could be biased.)", "images": []},
{"title": "missing", "links": "missing", "content": "The back-side 2 mm coils required full current to move the magnet reliably; about 600 mA compared to the 150 mA required by the top-side coils.", "images": []},
{"title": "missing", "links": "missing", "content": "With the basic hardware established, I see three directions for future work:", "images": []},
{"title": "missing", "links": "missing", "content": "Levitation / sliding enhancements: I bought pyrolytic graphite from two sources, but neither clearly levitates my magnets.\nI\u2019m not sure if my samples are substantially different than what SRI used; I have crystalline blocks and they they appear to use flexible sheet \u2014 perhaps ", "images": []},
{"title": "missing", "links": "missing", "content": "?\nBoth SRI and Miniatur Wunderland use Halbach arrays of thin square magnets rather than the disk magnets I\u2019m using; perhaps that extra 4/\u03c0 worth of magnet or the lack of free space between magnets makes all the difference to levitation?", "images": []},
{"title": "missing", "links": "missing", "content": "I could also try improving sliding performance by treating the PCB surface with dry lubricant or drilling open vias / through holes and adding pressurized air to make a sort of air-hockey table (though I have no idea if the millimeter length scale skews more or less stable than the centimeter scale of an air-hockey puck).", "images": []},
{"title": "missing", "links": "missing", "content": "I\u2019d also need to figure out a protocol for measuring sliding friction \u2014 many repetitions of gently tilting a surface and measuring the angle when things slide off?", "images": []},
{"title": "missing", "links": "missing", "content": "Control software: G-code interpreter, closed-loop computer-vision feedback system, zone synchronization (i.e., for a robot to traverse two v1 PCBs side-by-side, the coil phases must match up).\nThere\u2019s a lot to explore in particular if I get levitation working, as this ", "images": []},
{"title": "missing", "links": "missing", "content": " notes:", "images": []},
{"title": "missing", "links": "missing", "content": "As will be appreciated by those skilled in the art, many other commutations may be applied to the coils to achieve force and motion in the x, y, and z directions and torque and rotation about the x, y, and z axes. ", "images": []},
{"title": "missing", "links": "missing", "content": "Applications: Try and do something with the platform \u2014 sort grains of sand, self-moving tiny chess set, flight or ship tracker table top model, cheap precision x/y stage for super-resolution microscopy, some kind of clock/watch aesthetic complications, etc.\nIn addition to refining the platform positioning and velocity accuracy, some applications may also entail designing and manufacturing end-effectors like cute lil\u2019 robot arms or tiny cow catchers.", "images": []},
{"title": "missing", "links": "missing", "content": "All of these directions will inform the next PCB design, which I expect will need to be 4-layers so the two coil layers are closer to the surface.\nIt may also make sense in some cases to use more expensive 0.1 mm thick 2-layer ", "images": []},
{"title": "missing", "links": "missing", "content": ".", "images": []},
{"title": "missing", "links": "missing", "content": "If you liked this, you might like ", "images": []},
{"title": "missing", "links": "missing", "content": ".", "images": []},
{"title": "missing", "links": "missing", "content": "As an Amazon Associate, we may earn commissions from qualifying purchases from Amazon.com.", "images": []}
]